"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EditorTab = void 0;
const $ = require("jquery");
const types_1 = require("../types");
const schema_1 = require("../schema/schema");
const utils_1 = require("../utils");
// const JSONEditor = require("@json-editor/json-editor").JSONEditor;
// declare global {
//     const JSONEditor:any;
// }
let swr = (obj, r) => {
    for (let key of Object.getOwnPropertyNames(obj)) {
        let val = obj[key];
        if (typeof val === "string") {
            if (val.match(/^#[0-9a-fA-F]{8}$/)) {
                let split = val.match(/[0-9a-fA-F]{2}/g);
                if (r) {
                    split.unshift(split.pop());
                }
                else {
                    split.push(split.shift());
                }
                obj[key] = "#" + split.join("");
            }
        }
        else if (val && typeof val === "object" || Array.isArray(val)) {
            swr(val, r);
        }
    }
    return obj;
};
let editors = {};
let holders = {};
let current = types_1.ItemType.Undefined;
let curData;
class EditorTab {
    static async init() {
        let root = $("#contentHolder");
        for (let editor of utils_1.values(editors)) {
            editor.destroy();
        }
        holders = {};
        root.empty();
        for (let type of utils_1.values(types_1.ItemTypesMap)) {
            let typeSchema = schema_1.schemaForType(type);
            let holder = $(`<div id="editor_holder" data-theme="html"></div>`);
            root.append(holder);
            holders[type] = holder;
            editors[type] = new JSONEditor(holder[0], {
                schema: typeSchema,
                "template": "default",
                "show_errors": "always",
                "required_by_default": 1,
                "show_opt_in": 1,
                "disable_properties": 1,
                "enable_array_copy": 1,
                "disable_array_delete_all_rows": 1,
                "disable_array_delete_last_row": 1,
                "prompt_before_delete": 1
            });
        }
        EditorTab.closeAll();
    }
    static closeAll() {
        for (let type of utils_1.values(types_1.ItemTypesMap)) {
            EditorTab.close(type);
        }
    }
    static close(type) {
        // editors[type].disable();
        holders[type].hide();
    }
    static show(type) {
        EditorTab.close(current);
        current = type;
        // editors[type].enable();
        holders[type].show();
    }
    static feedData(data) {
        let type = data.ItemType;
        EditorTab.show(type);
        editors[current].setValue({});
        // let hold = $(editors[current].element);
        // let inp = hold.find(".je-switcher")[0] as HTMLSelectElement;
        // inp.value=ItemTypesMapRev[type];
        // let ev = new Event('change');
        // inp.dispatchEvent(ev);
        curData = swr(utils_1.clone(data), false);
        editors[current].setValue(curData);
    }
    static getData() {
        let data = editors[current].getValue();
        return swr(utils_1.clone(data), true);
    }
}
exports.EditorTab = EditorTab;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdG9yVGFiLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRWRpdG9yVGFiLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDRCQUE0QjtBQUM1QixvQ0FBeUU7QUFDekUsNkNBQStDO0FBQy9DLG9DQUF1QztBQUV2QyxxRUFBcUU7QUFDckUsbUJBQW1CO0FBQ25CLDRCQUE0QjtBQUM1QixJQUFJO0FBQ0osSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFRLEVBQUUsQ0FBVSxFQUFFLEVBQUU7SUFDL0IsS0FBSyxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDN0MsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFO1lBQ3pCLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFO2dCQUNoQyxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFhLENBQUM7Z0JBQ3JELElBQUksQ0FBQyxFQUFFO29CQUNILEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBWSxDQUFDLENBQUM7aUJBQ3hDO3FCQUFNO29CQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBWSxDQUFDLENBQUM7aUJBQ3ZDO2dCQUNELEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzthQUNuQztTQUNKO2FBQU0sSUFBSSxHQUFHLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDN0QsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNmO0tBQ0o7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNmLENBQUMsQ0FBQTtBQUVELElBQUksT0FBTyxHQUEwQixFQUFFLENBQUM7QUFDeEMsSUFBSSxPQUFPLEdBQW1DLEVBQUUsQ0FBQztBQUNqRCxJQUFJLE9BQU8sR0FBYSxnQkFBUSxDQUFDLFNBQVMsQ0FBQztBQUMzQyxJQUFJLE9BQWUsQ0FBQztBQUVwQixNQUFhLFNBQVM7SUFDWCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUk7UUFDcEIsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFL0IsS0FBSyxJQUFJLE1BQU0sSUFBSSxjQUFNLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDaEMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1NBQ3BCO1FBQ0QsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUViLEtBQUssSUFBSSxJQUFJLElBQUksY0FBTSxDQUFDLG9CQUFZLENBQUMsRUFBRTtZQUNuQyxJQUFJLFVBQVUsR0FBRyxzQkFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JDLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1lBQ25FLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDcEIsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQztZQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUN0QyxNQUFNLEVBQUUsVUFBVTtnQkFDbEIsVUFBVSxFQUFFLFNBQVM7Z0JBQ3JCLGFBQWEsRUFBRSxRQUFRO2dCQUN2QixxQkFBcUIsRUFBRSxDQUFDO2dCQUN4QixhQUFhLEVBQUUsQ0FBQztnQkFDaEIsb0JBQW9CLEVBQUUsQ0FBQztnQkFDdkIsbUJBQW1CLEVBQUUsQ0FBQztnQkFDdEIsK0JBQStCLEVBQUUsQ0FBQztnQkFDbEMsK0JBQStCLEVBQUUsQ0FBQztnQkFDbEMsc0JBQXNCLEVBQUUsQ0FBQzthQUM1QixDQUFDLENBQUM7U0FDTjtRQUNELFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRU0sTUFBTSxDQUFDLFFBQVE7UUFDbEIsS0FBSyxJQUFJLElBQUksSUFBSSxjQUFNLENBQUMsb0JBQVksQ0FBQyxFQUFFO1lBQ25DLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDekI7SUFDTCxDQUFDO0lBRU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFjO1FBQzlCLDJCQUEyQjtRQUMzQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVNLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBYztRQUM3QixTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3pCLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFFZiwwQkFBMEI7UUFDMUIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFTSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQWtCO1FBQ3JDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDekIsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQixPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzlCLDBDQUEwQztRQUMxQywrREFBK0Q7UUFDL0QsbUNBQW1DO1FBQ25DLGdDQUFnQztRQUNoQyx5QkFBeUI7UUFDekIsT0FBTyxHQUFHLEdBQUcsQ0FBQyxhQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRU0sTUFBTSxDQUFDLE9BQU87UUFDakIsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3ZDLE9BQU8sR0FBRyxDQUFDLGFBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNsQyxDQUFDO0NBQ0o7QUFuRUQsOEJBbUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgJCBmcm9tIFwianF1ZXJ5XCI7XHJcbmltcG9ydCB7RGF0YWJhc2VGaWxlLCBJdGVtVHlwZSwgSXRlbVR5cGVzTWFwLCBOdW1iZXJNYXB9IGZyb20gXCIuLi90eXBlc1wiO1xyXG5pbXBvcnQge3NjaGVtYUZvclR5cGV9IGZyb20gXCIuLi9zY2hlbWEvc2NoZW1hXCI7XHJcbmltcG9ydCB7Y2xvbmUsIHZhbHVlc30gZnJvbSBcIi4uL3V0aWxzXCI7XHJcblxyXG4vLyBjb25zdCBKU09ORWRpdG9yID0gcmVxdWlyZShcIkBqc29uLWVkaXRvci9qc29uLWVkaXRvclwiKS5KU09ORWRpdG9yO1xyXG4vLyBkZWNsYXJlIGdsb2JhbCB7XHJcbi8vICAgICBjb25zdCBKU09ORWRpdG9yOmFueTtcclxuLy8gfVxyXG5sZXQgc3dyID0gKG9iajogYW55LCByOiBib29sZWFuKSA9PiB7XHJcbiAgICBmb3IgKGxldCBrZXkgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKSkge1xyXG4gICAgICAgIGxldCB2YWwgPSBvYmpba2V5XTtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAodmFsLm1hdGNoKC9eI1swLTlhLWZBLUZdezh9JC8pKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3BsaXQgPSB2YWwubWF0Y2goL1swLTlhLWZBLUZdezJ9L2cpIGFzIHN0cmluZ1tdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzcGxpdC51bnNoaWZ0KHNwbGl0LnBvcCgpIGFzIHN0cmluZyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNwbGl0LnB1c2goc3BsaXQuc2hpZnQoKSBhcyBzdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqW2tleV0gPSBcIiNcIiArIHNwbGl0LmpvaW4oXCJcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHZhbCAmJiB0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiIHx8IEFycmF5LmlzQXJyYXkodmFsKSkge1xyXG4gICAgICAgICAgICBzd3IodmFsLCByKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2JqO1xyXG59XHJcblxyXG5sZXQgZWRpdG9yczogTnVtYmVyTWFwPEpTT05FZGl0b3I+ID0ge307XHJcbmxldCBob2xkZXJzOiBOdW1iZXJNYXA8SlF1ZXJ5PEhUTUxFbGVtZW50Pj4gPSB7fTtcclxubGV0IGN1cnJlbnQ6IEl0ZW1UeXBlID0gSXRlbVR5cGUuVW5kZWZpbmVkO1xyXG5sZXQgY3VyRGF0YTogb2JqZWN0O1xyXG5cclxuZXhwb3J0IGNsYXNzIEVkaXRvclRhYiB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGluaXQoKSB7XHJcbiAgICAgICAgbGV0IHJvb3QgPSAkKFwiI2NvbnRlbnRIb2xkZXJcIik7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGVkaXRvciBvZiB2YWx1ZXMoZWRpdG9ycykpIHtcclxuICAgICAgICAgICAgZWRpdG9yLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaG9sZGVycyA9IHt9O1xyXG4gICAgICAgIHJvb3QuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgdHlwZSBvZiB2YWx1ZXMoSXRlbVR5cGVzTWFwKSkge1xyXG4gICAgICAgICAgICBsZXQgdHlwZVNjaGVtYSA9IHNjaGVtYUZvclR5cGUodHlwZSk7XHJcbiAgICAgICAgICAgIGxldCBob2xkZXIgPSAkKGA8ZGl2IGlkPVwiZWRpdG9yX2hvbGRlclwiIGRhdGEtdGhlbWU9XCJodG1sXCI+PC9kaXY+YCk7XHJcbiAgICAgICAgICAgIHJvb3QuYXBwZW5kKGhvbGRlcik7XHJcbiAgICAgICAgICAgIGhvbGRlcnNbdHlwZV0gPSBob2xkZXI7XHJcbiAgICAgICAgICAgIGVkaXRvcnNbdHlwZV0gPSBuZXcgSlNPTkVkaXRvcihob2xkZXJbMF0sIHtcclxuICAgICAgICAgICAgICAgIHNjaGVtYTogdHlwZVNjaGVtYSxcclxuICAgICAgICAgICAgICAgIFwidGVtcGxhdGVcIjogXCJkZWZhdWx0XCIsXHJcbiAgICAgICAgICAgICAgICBcInNob3dfZXJyb3JzXCI6IFwiYWx3YXlzXCIsXHJcbiAgICAgICAgICAgICAgICBcInJlcXVpcmVkX2J5X2RlZmF1bHRcIjogMSxcclxuICAgICAgICAgICAgICAgIFwic2hvd19vcHRfaW5cIjogMSxcclxuICAgICAgICAgICAgICAgIFwiZGlzYWJsZV9wcm9wZXJ0aWVzXCI6IDEsXHJcbiAgICAgICAgICAgICAgICBcImVuYWJsZV9hcnJheV9jb3B5XCI6IDEsXHJcbiAgICAgICAgICAgICAgICBcImRpc2FibGVfYXJyYXlfZGVsZXRlX2FsbF9yb3dzXCI6IDEsXHJcbiAgICAgICAgICAgICAgICBcImRpc2FibGVfYXJyYXlfZGVsZXRlX2xhc3Rfcm93XCI6IDEsXHJcbiAgICAgICAgICAgICAgICBcInByb21wdF9iZWZvcmVfZGVsZXRlXCI6IDFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEVkaXRvclRhYi5jbG9zZUFsbCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY2xvc2VBbGwoKSB7XHJcbiAgICAgICAgZm9yIChsZXQgdHlwZSBvZiB2YWx1ZXMoSXRlbVR5cGVzTWFwKSkge1xyXG4gICAgICAgICAgICBFZGl0b3JUYWIuY2xvc2UodHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY2xvc2UodHlwZTogSXRlbVR5cGUpIHtcclxuICAgICAgICAvLyBlZGl0b3JzW3R5cGVdLmRpc2FibGUoKTtcclxuICAgICAgICBob2xkZXJzW3R5cGVdLmhpZGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHNob3codHlwZTogSXRlbVR5cGUpIHtcclxuICAgICAgICBFZGl0b3JUYWIuY2xvc2UoY3VycmVudCk7XHJcbiAgICAgICAgY3VycmVudCA9IHR5cGU7XHJcblxyXG4gICAgICAgIC8vIGVkaXRvcnNbdHlwZV0uZW5hYmxlKCk7XHJcbiAgICAgICAgaG9sZGVyc1t0eXBlXS5zaG93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBmZWVkRGF0YShkYXRhOiBEYXRhYmFzZUZpbGUpIHtcclxuICAgICAgICBsZXQgdHlwZSA9IGRhdGEuSXRlbVR5cGU7XHJcbiAgICAgICAgRWRpdG9yVGFiLnNob3codHlwZSk7XHJcbiAgICAgICAgZWRpdG9yc1tjdXJyZW50XS5zZXRWYWx1ZSh7fSk7XHJcbiAgICAgICAgLy8gbGV0IGhvbGQgPSAkKGVkaXRvcnNbY3VycmVudF0uZWxlbWVudCk7XHJcbiAgICAgICAgLy8gbGV0IGlucCA9IGhvbGQuZmluZChcIi5qZS1zd2l0Y2hlclwiKVswXSBhcyBIVE1MU2VsZWN0RWxlbWVudDtcclxuICAgICAgICAvLyBpbnAudmFsdWU9SXRlbVR5cGVzTWFwUmV2W3R5cGVdO1xyXG4gICAgICAgIC8vIGxldCBldiA9IG5ldyBFdmVudCgnY2hhbmdlJyk7XHJcbiAgICAgICAgLy8gaW5wLmRpc3BhdGNoRXZlbnQoZXYpO1xyXG4gICAgICAgIGN1ckRhdGEgPSBzd3IoY2xvbmUoZGF0YSksIGZhbHNlKTtcclxuICAgICAgICBlZGl0b3JzW2N1cnJlbnRdLnNldFZhbHVlKGN1ckRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0RGF0YSgpIHtcclxuICAgICAgICBsZXQgZGF0YSA9IGVkaXRvcnNbY3VycmVudF0uZ2V0VmFsdWUoKTtcclxuICAgICAgICByZXR1cm4gc3dyKGNsb25lKGRhdGEpLCB0cnVlKTtcclxuICAgIH1cclxufSJdfQ==